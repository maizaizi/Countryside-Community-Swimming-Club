{% extends 'instructorhome.html' %}

{% block subcontent %}

<div class="container">
    <!-- Display the flash message after action -->
    {% for message in get_flashed_messages() %}
    <div class="alert alert-danger text-center my-4" role="alert">
        <p class="pt-3"><b>{{ message }}</b></p>
    </div>
    {% endfor %}
   
    <div>
        <h3 class="text-center pt-5 mb-3">My Timetable</h3>
    </div>

    <!-- Button to return to view all timetables -->
    <div class="row justify-content-center mt-3">
        <div class="col-8 text-center">
            <a href="{{ url_for('instructor.view_timetable') }}" class="btn btn-outline-success fw-bold">View All Timetables</a>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-12">
            <table id="myTimetable" class="table table-success table-hover table-striped text-center my-3">
                <thead>
                    <tr>
                        <th scope="col">Time</th>
                        <th scope="col">Monday</th>
                        <th scope="col">Tuesday</th>
                        <th scope="col">Wednesday</th>
                        <th scope="col">Thursday</th>
                        <th scope="col">Friday</th>
                        <th scope="col">Saturday</th>
                        <th scope="col">Sunday</th>
                    </tr>
                </thead>
                <tbody>
                    {% for hour in range(6, 20) %}
                    <tr>
                        <td>{{ hour }}:00 - {{ hour + 1 }}:00</td>
                        {% for day in ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'] %}
                        <td id="{{ day }}-{{ hour }}" class="schedule-cell"></td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
    fetchWeekClasses();
});

function fetchWeekClasses() {
    fetch('/instructor/view_mytimetable')
        .then(response => response.json())
        .then(data => {
            fillTimetable(data);
        })
        .catch(error => console.error('Error fetching classes:', error));
}

function fillTimetable(classes) {
    classes.forEach(cls => {
        const day = cls.day.charAt(0) + cls.day.slice(1).toLowerCase();
        const startHour = cls.start_time.split(':')[0];
        const cellId = `${day}-${startHour}`;
        const cell = document.getElementById(cellId);
        
        if (cell) {
            let classInfoHtml = `<div class="class-info"><strong>${cls.class_name}</strong><br><span>Pool: ${cls.pool_name}</span>`;
            if (cls.pool_name === 'Lane Pool') {
                classInfoHtml += `<br><span>Lane: ${cls.lane_name}</span>`;
            }
            const bookingInfoUrl = `/instructor/booking_info/${cls.schedule_id}`; 
            classInfoHtml += `<br><a href="${bookingInfoUrl}" class="btn btn-outline-success fw-bold">View Booking Information</a>`;

           
            classInfoHtml += `</div>`; 
            
            cell.innerHTML += classInfoHtml;
        }
    });
}
</script>
{% endblock %}
